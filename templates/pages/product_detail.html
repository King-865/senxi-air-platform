{% extends "base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<section class="bg-gray-50 py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="flex items-center space-x-2 text-sm">
            <a href="/" class="text-gray-500 hover:text-primary-600">首页</a>
            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
            <a href="/products" class="text-gray-500 hover:text-primary-600">产品中心</a>
            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
            <span class="text-gray-900">{{ product.name }}</span>
        </nav>
    </div>
</section>

<!-- Product Detail -->
<section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-12">
            <!-- Product Images -->
            <div class="lg:w-1/2">
                <div class="bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl p-8 mb-4">
                    <img id="main-image" src="{{ product.main_image }}" alt="{{ product.name }}" 
                         class="w-full h-96 object-contain"
                         onerror="this.src='https://via.placeholder.com/600x600?text=Product'">
                </div>
                <div class="flex space-x-4 overflow-x-auto pb-2">
                    {% for image in product.images %}
                    <button class="flex-shrink-0 w-20 h-20 bg-gray-100 rounded-lg overflow-hidden border-2 border-transparent hover:border-primary-500 transition-colors thumbnail-btn"
                            data-image="{{ image }}">
                        <img src="{{ image }}" alt="Product thumbnail" class="w-full h-full object-contain"
                             onerror="this.src='https://via.placeholder.com/100x100?text=Thumb'">
                    </button>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Product Info -->
            <div class="lg:w-1/2">
                <!-- Badges -->
                <div class="flex flex-wrap gap-2 mb-4">
                    {% if product.badge %}
                    <span class="px-3 py-1 bg-{{ product.badge_color }}-100 text-{{ product.badge_color }}-700 text-sm font-medium rounded-full">
                        {{ product.badge }}
                    </span>
                    {% endif %}
                    <span class="px-3 py-1 bg-green-100 text-green-700 text-sm font-medium rounded-full">
                        3年质保
                    </span>
                </div>
                
                <!-- Title -->
                <h1 class="text-3xl font-bold text-gray-900 mb-4">{{ product.name }}</h1>
                
                <!-- Rating -->
                <div class="flex items-center space-x-4 mb-6">
                    <div class="flex items-center">
                        {% for i in range(5) %}
                        <i data-lucide="star" class="w-5 h-5 {% if i < product.rating|int %}text-yellow-400 fill-current{% else %}text-gray-300{% endif %}"></i>
                        {% endfor %}
                        <span class="ml-2 font-medium">{{ product.rating }}</span>
                    </div>
                    <span class="text-gray-500">{{ product.reviews }} 条评价</span>
                    <span class="text-gray-500">{{ product.sales }} 人已购</span>
                </div>
                
                <!-- Price -->
                <div class="bg-gray-50 rounded-xl p-6 mb-6">
                    <div class="flex items-end space-x-4">
                        <span class="text-4xl font-bold text-primary-600">¥{{ product.price }}</span>
                        <span class="text-xl text-gray-400 line-through">¥{{ product.original_price }}</span>
                        <span class="px-2 py-1 bg-red-100 text-red-600 text-sm font-medium rounded">
                            省 ¥{{ product.original_price - product.price }}
                        </span>
                    </div>
                    <p class="text-gray-500 text-sm mt-2">含税价，全国包邮</p>
                </div>
                
                <!-- Tags -->
                <div class="flex flex-wrap gap-2 mb-6">
                    {% for tag in product.tags %}
                    <span class="px-3 py-1 bg-primary-50 text-primary-700 text-sm rounded-full">{{ tag }}</span>
                    {% endfor %}
                </div>
                
                <!-- Specs Summary -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-sm text-gray-500">适用面积</div>
                        <div class="font-semibold text-gray-900">{{ product.specs.area }}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-sm text-gray-500">CADR值</div>
                        <div class="font-semibold text-gray-900">{{ product.specs.cadr }}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-sm text-gray-500">噪音范围</div>
                        <div class="font-semibold text-gray-900">{{ product.specs.noise }}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-sm text-gray-500">滤网等级</div>
                        <div class="font-semibold text-gray-900">{{ product.specs.filter_level }}</div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex space-x-4 mb-6">
                    <button class="flex-1 py-4 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 transition-colors flex items-center justify-center space-x-2">
                        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                        <span>立即购买</span>
                    </button>
                    <button class="px-6 py-4 border border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2">
                        <i data-lucide="heart" class="w-5 h-5"></i>
                        <span>收藏</span>
                    </button>
                </div>
                
                <!-- Services -->
                <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="check-circle" class="w-4 h-4 text-primary-600"></i>
                        <span>正品保证</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <i data-lucide="check-circle" class="w-4 h-4 text-primary-600"></i>
                        <span>7天无理由退换</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <i data-lucide="check-circle" class="w-4 h-4 text-primary-600"></i>
                        <span>免费上门安装</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <i data-lucide="check-circle" class="w-4 h-4 text-primary-600"></i>
                        <span>3年质保</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Tabs -->
<section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Tabs -->
        <div class="flex border-b border-gray-200 mb-8">
            <button class="tab-btn px-6 py-4 text-primary-600 border-b-2 border-primary-600 font-medium" data-tab="detail">
                产品详情
            </button>
            <button class="tab-btn px-6 py-4 text-gray-500 hover:text-primary-600" data-tab="specs">
                规格参数
            </button>
            <button class="tab-btn px-6 py-4 text-gray-500 hover:text-primary-600" data-tab="reviews">
                用户评价 ({{ product.reviews }})
            </button>
        </div>
        
        <!-- Tab Content: Detail -->
        <div id="tab-detail" class="tab-content">
            <div class="bg-white rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">产品特点</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    {% for feature in product.features %}
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i data-lucide="{{ feature.icon }}" class="w-6 h-6 text-primary-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 mb-1">{{ feature.title }}</h3>
                            <p class="text-gray-600 text-sm">{{ feature.description }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <h2 class="text-2xl font-bold text-gray-900 mb-6">技术原理</h2>
                <div class="prose max-w-none text-gray-600">
                    <p>{{ product.description }}</p>
                </div>
            </div>
        </div>
        
        <!-- Tab Content: Specs -->
        <div id="tab-specs" class="tab-content hidden">
            <div class="bg-white rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">详细规格</h2>
                <table class="w-full">
                    <tbody class="divide-y divide-gray-200">
                        <tr>
                            <td class="py-4 text-gray-500 w-1/3">产品名称</td>
                            <td class="py-4 text-gray-900">{{ product.name }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">适用面积</td>
                            <td class="py-4 text-gray-900">{{ product.specs.area }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">颗粒物CADR</td>
                            <td class="py-4 text-gray-900">{{ product.specs.cadr }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">甲醛CADR</td>
                            <td class="py-4 text-gray-900">{{ product.specs.formaldehyde_cadr }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">噪音范围</td>
                            <td class="py-4 text-gray-900">{{ product.specs.noise }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">滤网等级</td>
                            <td class="py-4 text-gray-900">{{ product.specs.filter_level }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">额定功率</td>
                            <td class="py-4 text-gray-900">{{ product.specs.power }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">产品尺寸</td>
                            <td class="py-4 text-gray-900">{{ product.specs.dimensions }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">产品重量</td>
                            <td class="py-4 text-gray-900">{{ product.specs.weight }}</td>
                        </tr>
                        <tr>
                            <td class="py-4 text-gray-500">智能功能</td>
                            <td class="py-4 text-gray-900">{{ product.specs.smart_features }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab Content: Reviews -->
        <div id="tab-reviews" class="tab-content hidden">
            <div class="bg-white rounded-2xl p-8">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">用户评价</h2>
                    <div class="flex items-center space-x-2">
                        <span class="text-4xl font-bold text-primary-600">{{ product.rating }}</span>
                        <div>
                            <div class="flex items-center">
                                {% for i in range(5) %}
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>
                                {% endfor %}
                            </div>
                            <div class="text-sm text-gray-500">{{ product.reviews }} 条评价</div>
                        </div>
                    </div>
                </div>
                
                <!-- Sample Reviews -->
                <div class="space-y-6">
                    <div class="border-b border-gray-200 pb-6">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                    <span class="text-primary-600 font-bold">张</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">张先生</div>
                                    <div class="text-sm text-gray-500">2024-12-10</div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                {% for i in range(5) %}
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>
                                {% endfor %}
                            </div>
                        </div>
                        <p class="text-gray-600">
                            新房装修后买的，除甲醛效果很明显，开机后明显感觉空气清新了很多。噪音也很小，睡眠模式几乎听不到声音。非常满意！
                        </p>
                        <div class="flex items-center space-x-4 mt-3 text-sm text-gray-500">
                            <span class="px-2 py-1 bg-gray-100 rounded">新房除醛</span>
                            <span class="px-2 py-1 bg-gray-100 rounded">静音效果好</span>
                        </div>
                    </div>
                    
                    <div class="border-b border-gray-200 pb-6">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center">
                                    <span class="text-pink-600 font-bold">李</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">李女士</div>
                                    <div class="text-sm text-gray-500">2024-12-08</div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                {% for i in range(5) %}
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>
                                {% endfor %}
                            </div>
                        </div>
                        <p class="text-gray-600">
                            家里有宝宝，特意选了这款医疗级的。APP控制很方便，可以随时查看空气质量。滤芯更换提醒也很贴心。推荐给有宝宝的家庭！
                        </p>
                        <div class="flex items-center space-x-4 mt-3 text-sm text-gray-500">
                            <span class="px-2 py-1 bg-gray-100 rounded">母婴家庭</span>
                            <span class="px-2 py-1 bg-gray-100 rounded">智能控制</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                        查看更多评价
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
<section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-8">相关推荐</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            {% for related in related_products %}
            <a href="/product/{{ related.id }}" class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow">
                <div class="h-40 bg-gray-100">
                    <img src="{{ related.main_image }}" alt="{{ related.name }}" 
                         class="w-full h-full object-contain p-4"
                         onerror="this.src='https://via.placeholder.com/200x200?text=Product'">
                </div>
                <div class="p-4">
                    <h3 class="font-medium text-gray-900 mb-2 line-clamp-2">{{ related.name }}</h3>
                    <div class="text-primary-600 font-bold">¥{{ related.price }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Image gallery
    const mainImage = document.getElementById('main-image');
    const thumbnails = document.querySelectorAll('.thumbnail-btn');
    
    thumbnails.forEach(btn => {
        btn.addEventListener('click', function() {
            mainImage.src = this.dataset.image;
            thumbnails.forEach(t => t.classList.remove('border-primary-500'));
            this.classList.add('border-primary-500');
        });
    });
    
    // Tabs
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tab = this.dataset.tab;
            
            tabBtns.forEach(b => {
                b.classList.remove('text-primary-600', 'border-b-2', 'border-primary-600');
                b.classList.add('text-gray-500');
            });
            this.classList.remove('text-gray-500');
            this.classList.add('text-primary-600', 'border-b-2', 'border-primary-600');
            
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
        });
    });
});
</script>
{% endblock %}
